

对合排列的递推式推导基于组合分解思想，通过分析元素位置的可能性建立递推关系 [^1]。递推式为：

\[
I(n) = I(n-1) + (n-1) \times I(n-2)
\]

### 推导原理
1. **单独固定情形**：最后一个元素自成循环，方案数为 \( I(n-1) \)
2. **交换对情形**：最后一个元素与前面任一元素组成交换对，选择方式有 \( (n-1) \) 种，剩余元素形成对合排列的方案数为 \( I(n-2) \)

### 数学证明
设第 \( n \) 个元素有两种选择：
- **Case 1**：固定不动 → 前 \( n-1 \) 个元素构成对合排列 → \( I(n-1) \)
- **Case 2**：与第 \( k \) 个元素交换（\( 1 \leq k \leq n-1 \)）→ 选择 \( k \) 有 \( (n-1) \) 种方式，剩余 \( n-2 \) 元素构成对合排列 → \( (n-1) \times I(n-2) \)

### 复杂度分析
- **时间复杂度**：预处理 \( O(n) \)，查询 \( O(1) \)
- **空间复杂度**：预处理数组 \( O(n) \)

### 示例验证
- \( I(2) = I(1) + 1 \times I(0) = 1 + 1 = 2 \)
- \( I(3) = I(2) + 2 \times I(1) = 2 + 2 = 4 \)

### 代码实现
```python
MOD = 10**9+7
dp = [1, 1] + [0]*(10**6)
for i in range(2, 10**6+1):
    dp[i] = (dp[i-1] + (i-1)*dp[i-2]) % MOD
```

---

[^1]: 递推式推导基于组合数学中对合排列的结构分解原理，将问题分解为固定点和交换对两种情形。